<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jeux Guitarisation‚Ñ¢</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 15px;
    color: #333;
}

.container { max-width: 1200px; margin: 0 auto; }

header {
    text-align: center;
    color: white;
    margin: 30px 0;
}

header h1 {
    font-size: 2.2em;
    font-weight: bold;
    line-height: 1.2;
}

header .season { font-size: 1.1em; opacity:0.9; margin-top:5px; }

.months-progress {
    display:flex;
    justify-content:center;
    align-items:center;
    gap:12px;
    margin-top:20px;
    font-size: 20px;
}

.month-name {
    color:white;
    font-size:0.75em;
    font-weight:500;
    text-transform:uppercase;
    letter-spacing:1px;
}

.month-item.current .month-name { font-weight:bold; text-shadow:0 0 5px rgba(255,255,255,0.5); }
.month-item.xcurrent .month-name { opacity:0.5; }

.month-connector { width:25px; height:2px; background: rgba(255,255,255,0.3); margin:0 3px; }

.content-grid {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap: 20px;
    align-items: stretch;
}

.section {
    background:white;
    border-radius:12px;
    padding:20px;
    box-shadow:0 8px 15px rgba(0,0,0,0.15);
    height: 100%;
}

.section h2 {
    color:#667eea;
    margin-bottom:15px;
    font-size:1.7em;
    border-bottom:2px solid #667eea;
    padding-bottom:8px;
    text-align: center;
}

.podium-container { display:flex; flex-direction:column; gap:8px; padding:5px 0; }
.podium-item {
    display:flex;
    align-items:center;
    padding:10px;
    background:rgba(255,255,255,0.95);
    border-radius:10px;
    box-shadow:0 3px 10px rgba(0,0,0,0.1);
}

.medal { font-size:1.8em; margin-right:12px; min-width:45px; text-align:center; }
.team-info { flex:1; }
.team-name-podium { font-size:1.2em; font-weight:bold; display: inline-flex; align-items: flex-start; gap: 6px;}
.team-members-podium { font-size:0.85em; color:#7f8c8d; }

.score-info { text-align:right; margin-right:8px; }
.score-podium { font-size:1.5em; font-weight:bold;}
.score-podium.gold { color:#FFD700; }
.score-podium.silver { color:#C0C0C0; }
.score-podium.bronze { color:#CD7F32; }

.leaderboard-table { width:100%; border-collapse:collapse; margin-top:10px; }
.leaderboard-table th {
    background:#667eea;
    color:white;
    padding:10px;
    text-align:left;
    font-weight:600;
}
.leaderboard-table th:first-child { border-radius:8px 0 0 8px; }
.leaderboard-table th:last-child { border-radius:0 8px 8px 0; }
.leaderboard-table td { padding:8px; border-bottom:1px solid #e0e0e0; vertical-align:middle; }

.rank { font-weight:bold; font-size:1.1em; width:40px; text-align:center; }
.rank-1 { color:#FFD700; }
.rank-2 { color:#C0C0C0; }
.rank-3 { color:#CD7F32; }

.badge {
    display:inline-block;
    padding:3px 8px;
    border-radius:12px;
    font-size:0.75em;
    font-weight:600;
    color:white;
}
.badge-clapton { background:#a8d5a8; color:#2d5f2d; }
.badge-santana { background:#f5a7a7; color:#8b3a3a; }
.badge-hendrix { background:#ffc896; color:#8b5a00; }

.score-cell { font-weight:bold; font-size:1.1em; color:#667eea; }
.activities { font-size:0.8em; color:#666; line-height:1.4em; }

.challenge-container { display: flex; flex-direction: column; gap: 8px; padding: 5px 0; }
.challenge-card {
    display: flex;
    align-items: center;
    gap:6px;
    padding: 15px;
    background: rgba(255,255,255,0.95);
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    font-weight: bold;
    font-size: 1.1em;
    color: #333;
    text-decoration: none;
    cursor: pointer;
    transition: color 0.2s, text-shadow 0.2s, transform 0.2s;
}
.challenge-card:hover { color:#000; transform: scale(1.01);}
.challenge-card .cta-badge {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    margin-left:auto;
    width:22px;
    height:22px;
    background: rgba(237, 240, 254, 0.784);
    border-radius:6px;
    transition: background 0.3s, transform 0.3s;
}
.challenge-card:hover .cta-badge { background: rgba(24, 28, 42, 0.1); transform: scale(1.1); }

.challenge-list a { display:block; font-weight:normal; color:#333; text-decoration:none; }
.challenge-list a strong { font-weight:bold; }

.tooltip { position: relative; display:flex; justify-content:center; align-items:center; cursor:pointer; font-size:1.1em; width:100%; }
.tooltip:hover { transform: scale(1.2); transition: transform 0.2s; }
.tooltip .tooltiptext {
    visibility: hidden;
    width: 120px;
    background-color: #333;
    color: #fff;
    text-align: left;
    border-radius: 8px;
    padding: 8px 10px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 0.8em;
    line-height: 1.4em;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
.tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

.badge-bonus-tooltip { position: relative; display:inline-flex; cursor:help; }
.badge-bonus-tooltip .tooltiptext {
    visibility: hidden;
    opacity:0;
    width:210px;
    background-color:#333;
    color:#fff;
    text-align:left;
    border-radius:8px;
    padding:8px 10px;
    position:absolute;
    z-index:10;
    bottom:130%;
    left:50%;
    transform:translateX(-50%);
    transition:opacity 0.3s;
    font-size:0.75em;
    line-height:1.4em;
    box-shadow:0 4px 8px rgba(0,0,0,0.2);
}
.badge-bonus-tooltip:hover .tooltiptext { visibility:visible; opacity:1; }

.badge-bonus {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:18px;
    height:18px;
    font-size:0.65em;
    background:#FFD700;
    color:white;
    text-shadow: 0 0 2px #fff, 0 0 3px #fff, 0 0 5px #fff;
    border-radius:50%;
    transform: translateY(-3px);
}
.badges-stack { position:relative; display:inline-block; width:18px; height:18px; }

.section.leaderboard { display:flex; flex-direction:column; height:100%; }
.section.leaderboard table { flex:1; width:100%; }

@media (max-width:992px) { .content-grid { grid-template-columns:1fr; } }
@media (max-width:480px) {
    body { padding:10px; font-size:0.85em; }
    header h1 { font-size:1.6em; }
    .month-name { font-size:0.65em; }
    .month-connector { width:10px; }
    .section { padding:12px; }
    .leaderboard-table th, .leaderboard-table td { padding:5px 3px; font-size:0.7em; }
}
tr.separator-non-classes td {
    border-top: 2px dashed #cfcfcf;
}
</style>
</head>
<body>
<div class="container">

<header>
    <h1>Jeux Guitarisation‚Ñ¢</h1>
    <div class="season">2025 - Trimestre 4</div>
    <div class="months-progress">
        <div class="month-item xcurrent"><div class="month-name">Octobre</div></div>
        <div class="month-connector"></div>
        <div class="month-item current"><div class="month-name">Novembre</div></div>
        <div class="month-connector"></div>
        <div class="month-item xcurrent"><div class="month-name">D√©cembre</div></div>
    </div>
</header>

<div class="content-grid">
    <!-- Colonne gauche -->
    <div style="display:flex; flex-direction:column; gap:20px;">

        <!-- Podium -->
        <div class="section">
            <h2>Classement des √âquipes</h2>
            <div class="podium-container"></div>
        </div>

        <!-- D√©fis -->
        <div class="section">
            <h2>D√©fis du mois</h2>
            <div class="challenge-container" id="defis-container"></div>
        </div>

       <!-- Bar√®me de points -->
<div class="section" style="padding-bottom:0px;"> 
    <h2>Bar√®me de Points</h2>
    <div class="challenge-list" id="bareme-container"></div>
</div>

    </div>

    <!-- Colonne droite : Leaderboard -->
    <div class="section leaderboard">
        <h2>Leaderboard G√©n√©ral</h2>
        <table class="leaderboard-table">
            <thead>
                <tr>
                    <th>Rang</th>
                    <th>Pseudo</th>
                    <th>√âquipe</th>
                    <th>Activit√©s</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<footer style="margin-top:40px; padding:15px 0; text-align:center; color:white;">
    <p style="margin:0; font-size:1em;">Continuez √† vous surpasser !</p>
    <p style="margin-top:5px; font-size:0.85em;">Les Jeux Guitarisation‚Ñ¢ par Samuel Ferton</p>
</footer>

<script>
// Fonction utilitaire pour convertir CSV en tableau
function csvToArray(str, delimiter = ",") {
    const lines = str.trim().split("\n");
    const headers = lines.shift().split(delimiter);
    return lines.map(line => {
        const values = line.split(delimiter);
        return headers.reduce((obj, header, i) => {
            obj[header.trim()] = values[i].trim();
            return obj;
        }, {});
    });
}

// ---------- LEADERBOARD ----------
const csvLeaderboardUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSLxwfOQ0vuEml32PC-4RXM_wu5XM8Pb38MIh_dHXTE07dfZ2Wgph8jTZy-F2JnjFO3bE94nmEnkb1X/pub?gid=1384291539&single=true&output=csv";

function renderLeaderboard(data) {
    const tbody = document.querySelector(".leaderboard-table tbody");
    tbody.innerHTML = "";

    const getBadgeClass = team => ({
        clapton:"badge-clapton",
        santana:"badge-santana",
        hendrix:"badge-hendrix"
    }[team.toLowerCase()] || "badge-default");

    // S√©paration class√©s / non class√©s
    const classes = data
        .filter(p => parseInt(p.Points) > 0)
        .sort((a,b) => parseInt(b.Points) - parseInt(a.Points));

    const nonClasses = data.filter(p => parseInt(p.Points) === 0);

    // Affichage des class√©s
    classes.forEach((player, index) => {
        const tr = document.createElement("tr");
        const rankClass = ["rank-1","rank-2","rank-3"][index] || "";

        tr.innerHTML = `
            <td class="rank ${rankClass}">${index + 1}</td>
            <td><strong>${player.Nom}</strong></td>
            <td><span class="badge ${getBadgeClass(player.√âquipe)}">${player.√âquipe}</span></td>
            <td class="activities">
                <div class="tooltip"> üîç
                    <span class="tooltiptext">
                        <strong>${player.Nom} :</strong><br>
                        ‚Ä¢ ${player.Ateliers || 0} Ateliers<br>
                        ‚Ä¢ ${player["Com."] || 0} Commentaires<br>
                        ‚Ä¢ ${player.Feedbacks || 0} Feedback<br>
                        ‚Ä¢ ${player.D√©fis || 0} D√©fi
                    </span>
                </div>
            </td>
            <td class="score-cell">${player.Points}</td>
        `;
        tbody.appendChild(tr);
    });

    // Affichage des non class√©s
nonClasses.forEach((player, index) => {
    const tr = document.createElement("tr");

    // ajoute la s√©paration uniquement au premier non class√©
    if (index === 0) {
        tr.classList.add("separator-non-classes");
    }

    tr.innerHTML = `
        <td class="rank" style="color:#aaa;">‚Äî</td>
        <td><strong>${player.Nom}</strong></td>
        <td><span class="badge ${getBadgeClass(player.√âquipe)}">${player.√âquipe}</span></td>
        <td class="activities">Non class√©</td>
        <td class="score-cell" style="color:#aaa;">0</td>
    `;
    tbody.appendChild(tr);
});
}

fetch(csvLeaderboardUrl)
    .then(res => res.text())
    .then(csv => renderLeaderboard(csvToArray(csv)))
    .catch(err => console.error("Erreur leaderboard :", err));

// ---------- PODIUM ----------
const csvPodiumUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSLxwfOQ0vuEml32PC-4RXM_wu5XM8Pb38MIh_dHXTE07dfZ2Wgph8jTZy-F2JnjFO3bE94nmEnkb1X/pub?gid=1423073894&single=true&output=csv";

function renderPodium(data) {
    const podium = document.querySelector(".podium-container");
    podium.innerHTML = "";

    data.forEach(team => {
        team.Total = parseInt(team.Total || "0");
        team.Membres = parseInt(team.Membres || "0");
        team.Badge = parseInt(team.Badge || "0");
    });

    data.sort((a,b) => b.Total - a.Total);

    const medals = ["ü•á","ü•à","ü•â"];

    data.forEach((team,index) => {
        let badgesHtml = `<span class="badges-stack">`;
        for(let i=0;i<team.Badge;i++){
            badgesHtml += `
            <span class="badge-bonus-tooltip" style="position:absolute; left:${i*12}px; z-index:${i}">
                <span class="badge-bonus">ü§ù</span>
                <span class="tooltiptext">Badge d'entraide : +3 pts</span>
            </span>`;
        }
        badgesHtml += `</span>`;

        const div = document.createElement("div");
        div.className = "podium-item";
        div.innerHTML = `
            <div class="medal">${medals[index] || ""}</div>
            <div class="team-info">
                <div class="team-name-podium">${team.√âquipe} ${badgesHtml}</div>
                <div class="team-members-podium">(${team.Membres} membres)</div>
            </div>
            <div class="score-info">
                <div class="score-podium ${["gold","silver","bronze"][index] || ""}">${team.Total}</div>
            </div>
        `;
        podium.appendChild(div);
    });
}

fetch(csvPodiumUrl)
    .then(res => res.text())
    .then(csv => renderPodium(csvToArray(csv)))
    .catch(err => console.error("Erreur podium :", err));

// ---------- D√âFIS ----------
const csvDefisUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSLxwfOQ0vuEml32PC-4RXM_wu5XM8Pb38MIh_dHXTE07dfZ2Wgph8jTZy-F2JnjFO3bE94nmEnkb1X/pub?gid=549182878&single=true&output=csv";

function renderDefis(data) {
    // r√©cup√®re le container (une seule d√©claration)
    const container = document.getElementById("defis-container");
    if (!container) {
        console.error("renderDefis: #defis-container introuvable.");
        return;
    }
    container.innerHTML = "";

    // defensive : v√©rifie les donn√©es
    if (!Array.isArray(data) || data.length === 0) {
        console.warn("renderDefis : pas de donn√©es re√ßues ou CSV vide.");
        const sectionFallback = container.closest(".section");
        if (sectionFallback) {
            const h2f = sectionFallback.querySelector("h2");
            if (h2f) h2f.textContent = "D√©fis du mois";
        }
        return;
    }

    // normalisation des en-t√™tes : retrouve la cl√© "mois" (insensible √† la casse)
    const headerKeys = Object.keys(data[0] || {});
    const moisKey = headerKeys.find(k => k && k.toLowerCase().includes("mois")) ||
                    headerKeys.find(k => k && k.toLowerCase().includes("month"));

    // r√©cup√®re la premi√®re valeur non vide de la colonne mois
    let mois = "";
    if (moisKey) {
        for (const row of data) {
            if (row[moisKey] && row[moisKey].trim() !== "") {
                mois = row[moisKey].trim();
                break;
            }
        }
    } else {
        console.warn("renderDefis : aucune colonne 'Mois' d√©tect√©e dans le CSV. En-t√™tes :", headerKeys);
    }

    // cible le h2 de la section contenant le container (correction cl√©)
    const section = container.closest(".section");
    const titreDefis = section ? section.querySelector("h2") : document.querySelector(".section h2");
    if (titreDefis) titreDefis.textContent = mois ? `D√©fis du mois de ${mois}` : "D√©fis du mois";

    // affiche les d√©fis (tol√®re plusieurs noms de colonne possibles)
    data.forEach(defi => {
        const name = defi.Noms || defi.Nom || defi.Titre || "";
        const url = defi.URL || "#";
        if (!name) return; // ignore lignes sans nom
        const a = document.createElement("a");
        a.href = url;
        a.target = "_blank";
        a.className = "challenge-card";
        a.innerHTML = `
            <span class="icon">üëâ</span> ${name}
            <span class="cta-badge" aria-hidden="true">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" focusable="false" aria-hidden="true">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
            </span>
        `;
        container.appendChild(a);
    });
}

fetch(csvDefisUrl)
    .then(res => res.text())
    .then(csv => renderDefis(csvToArray(csv)))
    .catch(err => console.error("Erreur d√©fis :", err));

// --- Header automatique ---
function updateHeader() {
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth(); // 0 = Janvier, 11 = D√©cembre

    // Calcul du trimestre (0-11 -> 1-4)
    const trimestre = Math.floor(month / 3) + 1;

    // Mise √† jour du texte "Ann√©e - Trimestre"
    const seasonEl = document.querySelector("header .season");
    seasonEl.textContent = `${year} - Trimestre ${trimestre}`;

    // Tableau des noms de mois
    const monthNames = ["Janvier","F√©vrier","Mars","Avril","Mai","Juin",
                        "Juillet","Ao√ªt","Septembre","Octobre","Novembre","D√©cembre"];

    // Mois du trimestre
    const startMonth = (trimestre - 1) * 3;
    const monthsInQuarter = [
        monthNames[startMonth],
        monthNames[startMonth + 1],
        monthNames[startMonth + 2]
    ];

    const monthItems = document.querySelectorAll(".months-progress .month-item");
    monthItems.forEach((item, i) => {
        item.querySelector(".month-name").textContent = monthsInQuarter[i];
        // Classes : current = mois courant
        item.classList.remove("current", "xcurrent");
        if (startMonth + i === month) item.classList.add("current");
        else item.classList.add("xcurrent");
    });
}

// Appel au chargement
updateHeader();

// ---------- BAR√àME DE POINTS ----------
const csvBaremeUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSLxwfOQ0vuEml32PC-4RXM_wu5XM8Pb38MIh_dHXTE07dfZ2Wgph8jTZy-F2JnjFO3bE94nmEnkb1X/pub?gid=1387947154&single=true&output=csv";

function renderBareme(data) {
    const container = document.getElementById("bareme-container");
    container.innerHTML = ""; // vide le contenu avant de remplir

    data.forEach(item => {
        const a = document.createElement("a");
        a.innerHTML = `<strong>${item.Titre}</strong> ${item.Points || ""} ${item.Commentaire || ""}`;
        container.appendChild(a);
        container.appendChild(document.createElement("br"));
    });
}

fetch(csvBaremeUrl)
    .then(res => res.text())
    .then(csv => renderBareme(csvToArray(csv)))
    .catch(err => console.error("Erreur bar√®me :", err));

</script>

</body>
</html>